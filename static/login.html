<!DOCTYPE html>
<!--[if IE 7]>    <html class="no-js ie7 ie all" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 ie all" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9 ie all" lang="en"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en" style="width:100%; height: 100%; margin: 0; padding: 0;">
<!--<![endif]-->

<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8">
    <title>北京泰合佳通信息技术有限公司</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <!--[if !IE]> -->
    <script src="/bower_components/jQuery/jQuery-2.1.3.min.js" type="text/javascript"></script>
    <!-- <![endif]-->
    <!--[if IE]>
       <script src="/bower_components/jQuery/jquery.min.js" type="text/javascript"></script>
    <![endif]-->
    <!--[if lt IE 9]>
      <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--[if lte IE 8]><script src="/bower_components/jQuery/selectivizr-min.js"></script><![endif]-->
    <!-- BEGIN THEME STYLES -->
    <!-- Bootstrap 3.3.4 -->
    <link href="/bower_components/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" />

    <link href="/bower_components/customUI/css/tes-control.css" rel="stylesheet" />

    <link href="/bower_components/customUI/css/login.css" rel="stylesheet" />
    <!--<link href="bower_components/adminLTE/css/skins/skin-green.min.css" rel="stylesheet"/>-->
    <!--<link href="bower_components/customUI/css/main.css" rel="stylesheet" />
    <link href="bower_components/customUI/css/Scalebar.css" rel="stylesheet" />-->
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="/favicon.ico">
    <!--<script src="/bower_components/jQuery/jQuery-2.1.3.min.js" type="text/javascript"></script>-->
    <script src="/bower_components/jQuery/jquery.cookie.js" type="text/javascript"></script>
    <script src="/bower_components/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/scripts/config.js" type="text/javascript"></script>
    <style type="text/css">
        .all {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #notiF{
            display:none;
        }
        input:-webkit-autofill {
            -webkit-box-shadow: 0 0 0px 1000px white inset;      
          /*border: 1px solid #CCC !important;*/
        }
    </style>
</head>


<body class="skin-blue sidebar-mini" style="width: 100%; height: 100%; margin: 0; padding: 0; overflow-y: hidden; background: url(imgs/userLogin.png) center center no-repeat;position:relative;">
    <div class="login-wrapper" style="height:100%;position:relative; background:none;">
        <div class="login-wrapper-header">
            <!--<div class="logo"></div>-->
            <!--<div style="color: #268eff;" class="logo">
                <h1 style="text-align:center;position:relative;font-size:24px;top:314px;z-index:1;font-weight:300;">T-DAAS精准营销平台</h1>
            </div>-->
        </div>
        <div class="login-controls" style="background: url(imgs/gradient.png) repeat-y; height: 343px; position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto; opacity: 0.99; ">
            <div class="form-wrapper" style="height:100%;">
                <h1 style="text-align:center;font-size:24px;font-weight:300;margin:0;">T-DAAS精准营销平台</h1>
                <div class="login-box" style="box-shadow: none; border-radius: 0; width: 450px; background: none; position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: auto;">
                    <!--<fieldset>
                        <legend><span>登录</span></legend>
                    </fieldset>-->
                    <div class="login-content clearfix">
                        <div class="login-text" style="border: 1px solid #808080;border-radius:0;
      padding:2px 9px; ">
                            <div class="input-group input-group-lg" style="position:relative;">
                                <input type="text" id="userName" class="form-control login-form-name" placeholder="账号" required style="width: 382px;" autocomplete="off">
                                <input type="text" id="password" class="form-control login-form-password" placeholder="密码" required style="border-top: 1px solid #999999; width: 382px;" autocomplete="off" onfocus="$(this).attr('type','password')">
                                <span style="position: absolute; top: 58px; right: -186px; color: #f46442;display:none; ">
                                    <img src="imgs/errorIcon.png" alt="Alternate Text" />
                                    用户名或密码输入有误
                                </span>
                            </div>

                            <div class="input-group input-group-lg" style="position:relative;">
                                <input type="text" id="verificationCode" class="form-control login-form-password" placeholder="验证码" required style="border-top: 1px solid #999999;width:382px;">
                                <span class="click pull-right" onclick="refreshImg();"><img alt="点击刷新" width="90" id="vi" height="40" /></span>

                                <span style="position: absolute;display:none; top: 15px; right: -153px; color: #f46442;">
                                    <img src="imgs/errorIcon.png" alt="Alternate Text" />
                                    验证码输入有误
                                </span>
                            </div>
                        </div>

                        <label id="remember-me" class="checkbox">
                            <input type="checkbox" id="isRemember"> 记住我
                        </label>
                        <div class="alert alert-danger" style="display:none;" id="msg" role="alert"></div>
                        <div class="login-button">
                            <button type="button" onclick="login(this);" class="btn blue btn-block" style="background-color: #3399fe;">登 录</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="wrapper-footer" style="background: none; color: #889bb9; position: absolute;">
            <span> 版权所有 Copyright © 2006 - 2016 Tescomm. All Rights Reserved 联系我们:13000000000</span>
        </div>
    </div>
    <!--<div style="position: absolute; top: 8px; right:10px; height: 40px;line-height:40px; width: 298px; background: #d9534f; color: white;padding-left:10px;" id="notiF">
        页面已失效，请重新登录！
    </div>-->
    <script type="text/javascript">
        jQuery.support.cors = true;
        var parentHeight = $(".login-wrapper").height();
        var selfOutHeight = $(".login-wrapper-header").outerHeight(true) - $(".login-footer").height() - 5;
        //$(".form-wrapper").height(parentHeight - selfOutHeight);
        var uid = $("#userName");
        var pwd = $("#password");
        var vc = $("#verificationCode");
        var msg = $("#msg");

        function showMsg(m) {
            msg.show();
            msg.text(m);
            window.setTimeout(function () { msg.hide(); }, 6000);
        }
        //刷新验证码
        function refreshImg() {
            var vi = $("#vi");
            vi.attr("src", window.app.AuthorizeHost + "Open/OAuth/GetVerifyCode?" + (new Date()).toString())
        };
        function login(btn) {
            if (uid.val().length == 0) {
                showMsg("用户名不能为空");
                return;
            }
            if (pwd.val().length == 0) {
                showMsg("密码不能为空");
                return;
            }
            /*
            if (vc.val().length == 0) {
                showMsg("验证码不能为空");
                return;
            }*/
            $(btn).text("登录中...");
            $(btn).attr("disabled", "disabled");
            $.ajax(window.app.AuthorizeHost + 'Open/OAuth/Login', {
                type: 'POST', data: {
                    userName: uid.val(), password: pwd.val(), verificationCode: vc.val(), clientId: window.app.Id
                    , callback: "/_authorizecallback?redirect_uri=/index.html"/*登录成功后显示的第一个页面，只需修改参数redirect_uri后对应的内容即可*/
                }, success: function (data, staus) {
                    refreshImg();
                    if (data.State) {
                        if ($("#isRemember:checked").length > 0) {
                            $.cookie('pe', data.Encrypt);
                            $.cookie('isRemember', "true");
                            $.cookie('u', uid.val());
                        }

                        else {
                            $.removeCookie('pe');
                            $.removeCookie('isRemember');
                            $.removeCookie('u');
                        }

                        //$.cookie('u', uid.val());
                        location.href = data.Callback + "&client_id=DAAS";
                    } else {
                        showMsg(data.Description);
                    }
                    $(btn).text("登  录");
                    $(btn).removeAttr("disabled");

                }
            , error: function (xhr, status, error) {
                refreshImg();
                showMsg('请求错误，' + error);
                $(btn).text("登  录");
                $(btn).removeAttr("disabled");
            }, dataType: "json"
            });
        }
        $(document).ready(function () {
          
            refreshImg();
            if ($.cookie("isRemember") == "true") {
                $("#isRemember").attr("checked", "checked");
                $("#password").attr('type', 'password');
                pwd.val($.cookie('pe'));
                uid.val($.cookie('u'));
            } else {
                uid.val("");
                pwd.val("");
            }
           
        });





        document.cookie = "lose=; expires=Thu, 01 Jan 1970 00:00:00 GMT";
    </script>
</body>
<!-- END BODY -->
</html>
